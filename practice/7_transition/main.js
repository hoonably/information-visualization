// ðŸ“„ SVG ìº”ë²„ìŠ¤ ìƒì„± (ê°€ë¡œ 500px, ì„¸ë¡œ 300px)
const svg = d3.select("body")
  .append("svg")
  .attr("width", 500)
  .attr("height", 300);

// ðŸ“Š ë‘ ê°œì˜ ë°ì´í„° ë°°ì—´ ì¤€ë¹„ (ì „í™˜ë  ëŒ€ìƒ)
const data1 = [30, 80, 45, 60, 20];
const data2 = [70, 40, 60, 10, 90];

// ðŸ§­ xì¶•: ë§‰ëŒ€ ìœ„ì¹˜ ì§€ì • (0~4ì˜ ì¸ë±ìŠ¤ë¥¼ ê¸°ì¤€ìœ¼ë¡œ ë¶„í¬)
const x = d3.scaleBand()
  .domain(d3.range(data1.length))      // [0, 1, 2, 3, 4] ìƒì„±
  .range([50, 450])                    // ì‹œìž‘ ìœ„ì¹˜: 50, ë: 450
  .padding(0.1);                       // ë§‰ëŒ€ ì‚¬ì´ ê°„ê²© ì„¤ì •

// ðŸ“ yì¶•: ê°’(0~100)ì„ ìœ„ì—ì„œ ì•„ëž˜ë¡œ ë°˜ì „ì‹œì¼œ ìœ„ì¹˜ ì§€ì •
const y = d3.scaleLinear()
  .domain([0, 100])                    // ë°ì´í„° ë²”ìœ„ 0~100
  .range([250, 50]);                   // í™”ë©´ì—ì„œëŠ” ì•„ëž˜ê°€ 0ì´ë¯€ë¡œ ë°˜ì „ë¨

// ðŸ”„ ë§‰ëŒ€ë¥¼ ê·¸ë¦¬ëŠ” í•¨ìˆ˜ (ë°ì´í„°ë¥¼ ì¸ìžë¡œ ë°›ìŒ)
const drawBars = (data) => {
  // í˜„ìž¬ svgì— ìžˆëŠ” ëª¨ë“  rectì™€ ìƒˆ ë°ì´í„° ì—°ê²° (ë°”ì¸ë”©)
  const bars = svg.selectAll("rect").data(data);

  // âž• enter: ìƒˆ ë°ì´í„°ì— í•´ë‹¹í•˜ëŠ” ë§‰ëŒ€ê°€ ì—†ì„ ë•Œ ìƒˆë¡œ ì¶”ê°€
  bars.enter()
    .append("rect")                      // ìƒˆë¡œìš´ ë§‰ëŒ€ ì¶”ê°€
    .attr("x", (d, i) => x(i))           // x ìœ„ì¹˜: ì¸ë±ìŠ¤ ê¸°ë°˜ ìœ„ì¹˜
    .attr("y", y(0))                     // ì²˜ìŒì—ëŠ” yì¶• ì•„ëž˜ìª½ì—ì„œ ì‹œìž‘
    .attr("width", x.bandwidth())       // ë§‰ëŒ€ ë„ˆë¹„ ì„¤ì •
    .attr("height", 0)                  // ì´ˆê¸° ë†’ì´ëŠ” 0
    .attr("fill", "steelblue")          // ê¸°ë³¸ ìƒ‰ìƒ
    .transition()                       // ì• ë‹ˆë©”ì´ì…˜ ì ìš©
    .duration(800)                      // 0.8ì´ˆ ë™ì•ˆ
    .attr("y", d => y(d))               // ìµœì¢… ìœ„ì¹˜ ìœ„ë¡œ ìƒìŠ¹
    .attr("height", d => 250 - y(d));   // ìµœì¢… ë†’ì´ ê³„ì‚°

  // ðŸ” update: ê¸°ì¡´ ë§‰ëŒ€ê°€ ìƒˆ ë°ì´í„°ë¡œ ë³€ê²½ë  ê²½ìš°
  bars.transition()
    .duration(800)
    .attr("y", d => y(d))               // ê°’ì— ë”°ë¼ ìœ„ì¹˜ ê°±ì‹ 
    .attr("height", d => 250 - y(d))    // ë†’ì´ ê°±ì‹ 
    .attr("fill", d => d > 60 ? "tomato" : "steelblue"); // ì¡°ê±´ì— ë”°ë¼ ìƒ‰ìƒ ë³€ê²½

  // âž– exit: ì´ì „ ë°ì´í„°ì—ëŠ” ìžˆì—ˆì§€ë§Œ ìƒˆë¡œìš´ ë°ì´í„°ì—ëŠ” ì—†ëŠ” ë§‰ëŒ€ ì œê±°
  bars.exit()
    .transition()
    .duration(500)
    .attr("y", y(0))                    // ì•„ëž˜ë¡œ ë‚´ë ¤ê°
    .attr("height", 0)                  // ë†’ì´ 0ìœ¼ë¡œ ì¤„ì´ê¸°
    .remove();                          // DOMì—ì„œ ì œê±°
};

// âœ… ì´ˆê¸° ìƒíƒœë¡œ data1 ë§‰ëŒ€ë“¤ ê·¸ë¦¬ê¸°
drawBars(data1);

// ðŸ”˜ HTMLì—ì„œ IDê°€ "update"ì¸ ë²„íŠ¼ í´ë¦­ ì‹œ ë°ì´í„° ì „í™˜
d3.select("#update").on("click", () => {
  drawBars(data2); // data2ë¡œ ë°” ì°¨íŠ¸ ê°±ì‹ 
});
